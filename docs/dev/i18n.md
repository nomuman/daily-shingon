# i18n（多言語対応）ベストプラクティス（Expo / React Native）

対象: Expo初心者 + TypeScript経験あり  
目標: 「まいにち真言 / Daily Shingon」を日英対応し、将来言語追加もしやすい構成にする

---

## 0. 結論（推奨スタック）

### 推奨: `expo-localization` + `i18next` + `react-i18next`

- 端末ロケール取得は Expo 公式の `expo-localization` を使う。:contentReference[oaicite:0]{index=0}
- UI文言の翻訳管理は i18next / react-i18next を使う（React Native対応・エコシステムが強い）。:contentReference[oaicite:1]{index=1}

> Expo公式ガイドでは `expo-localization` + `i18n-js` の例もあるが、言語数/文量が増えるなら i18next の伸びが良い。:contentReference[oaicite:2]{index=2}

---

## 1. 重要な原則（事故を防ぐ）

1. **言語の決定は「端末」＋「ユーザー選択」を分離する**

- 初回は端末ロケールを採用
- ユーザーがアプリ内で言語を選んだら、以後はそれを優先（保存）

2. **翻訳キーは“文”ではなく“意味”で切る**

- ✅ `home.practice.startButton`
- ❌ `press_here_to_start`（文章変更で崩壊する）

3. **文字列の連結をコードでしない**

- `t('hello') + name` のような合成は避け、翻訳側で補間（interpolation）する

4. **複数形は必ず i18next の仕組みで処理する**

- i18next の plural は `count` が必須（`count` が無いと期待通りに出ない）。:contentReference[oaicite:3]{index=3}

5. **RTL（右→左）を壊さない**

- 必要に応じて `I18nManager` で RTL を扱う。:contentReference[oaicite:4]{index=4}

---

## 2. ディレクトリ設計（おすすめ）

```

/lib/i18n/
index.ts # i18n初期化・設定
detectLocale.ts # 端末ロケール判定・優先順位
resources.ts # 翻訳リソースの読み込み（最初は直読みでOK）
/locales/
ja/
common.json
learn.json
en/
common.json
learn.json

```

- 名前空間（namespace）は画面/機能単位で分ける: `common`, `learn`, `home`, `settings` など

---

## 3. ロケール取得のベストプラクティス（Expo）

### 端末ロケール取得

- `expo-localization` の `getLocales()` を使う。:contentReference[oaicite:5]{index=5}

### Androidの注意（超重要）

Androidは、ユーザーが設定で言語を変えても **アプリ再起動なしで変わる**ことがある。
そのため、**フォアグラウンド復帰時に `getLocales()` を取り直す**（AppStateなどで検知）。:contentReference[oaicite:6]{index=6}

---

## 4. i18next / react-i18next 運用ルール

### 4.1 `t()` の基本

- 通常は `t('key.path')` で十分
- React要素を埋め込みたい時だけ `<Trans>` を使う（使いすぎない）:contentReference[oaicite:7]{index=7}

### 4.2 Plural（複数形）ルール

- i18next の plural は `count` が必須。:contentReference[oaicite:8]{index=8}

例:

- `t('notifications', { count: 1 })`
- `t('notifications', { count: 3 })`

### 4.3 翻訳ファイルの品質ルール

- **en/ja でキー構造を一致**させる（欠損があると画面で事故る）
- 翻訳の空文字は避ける（未翻訳検知の妨げ）

---

## 5. Expo Router と i18n 初期化

### ルール

- i18n は **Root（`app/_layout.tsx`）の一番上で初期化**してから画面を描画する
  （ルーティング後に初期化すると、一瞬別言語で描画されることがある）

---

## 6. RTL（右→左）対応の指針

- React Native は RTL 向けに `I18nManager` を提供している。:contentReference[oaicite:9]{index=9}
- 基本は Flexbox を正しく使っていれば多くのUIは対応できるが、以下は要注意:
  - 絶対配置（`position: 'absolute'`）で left/right に依存
  - アニメーションで x方向の移動が固定
- 対処:
  - `I18nManager.isRTL` を見て調整（必要な場所だけ）:contentReference[oaicite:10]{index=10}

---

## 7. ストアで「対応言語」をOS設定に出す（任意だが推奨）

よりOSネイティブな言語設定表示（Android 13+ / iOS）に寄せたい場合、`react-native-localize` の Expo plugin で「対応言語」を宣言できる。:contentReference[oaicite:11]{index=11}

例（app.json / app.config.ts）:

```json
{
  "expo": {
    "plugins": [["react-native-localize", { "locales": ["en", "ja"] }]]
  }
}
```

---

## 8. よくあるミス集（レビュー観点）

- [ ] 翻訳キーが「文章」になっている（変更に弱い）
- [ ] `count` を渡さず plural を使っている（i18next仕様）([i18next][1])
- [ ] 画面中で `+` で文字列結合している（言語で語順が変わる）
- [ ] Androidで言語変更したのにアプリが追従しない（フォアグラウンド復帰で再取得が必要）([Expo Documentation][2])
- [ ] `left/right` 固定のUIで RTL が崩れる（I18nManagerで調整）([React Native][3])

---

## 9. 参考リンク（一次情報）

- Expo Guide: Localization（expo-localization + 多言語対応の考え方）([Expo Documentation][4])
- Expo SDK: expo-localization（Androidはフォアグラウンド復帰で再取得推奨）([Expo Documentation][2])
- react-i18next（React/React Native向け i18next ラッパー）([react-i18next][5])
- i18next Plurals（`count` 必須など）([i18next][1])
- React Native: I18nManager（RTL制御）([React Native][3])
- React Native Blog: RTL Support（RTL-ready UIの考え方）([React Native][6])
- react-native-localize（Expo pluginで対応言語を宣言）([GitHub][7])

[1]: https://www.i18next.com/translation-function/plurals?utm_source=chatgpt.com 'Plurals | i18next documentation'
[2]: https://docs.expo.dev/versions/latest/sdk/localization/?utm_source=chatgpt.com 'Localization'
[3]: https://reactnative.dev/docs/i18nmanager?utm_source=chatgpt.com 'I18nManager'
[4]: https://docs.expo.dev/guides/localization/?utm_source=chatgpt.com 'Localization'
[5]: https://react.i18next.com/?utm_source=chatgpt.com 'react-i18next documentation: Introduction'
[6]: https://reactnative.dev/blog/2016/08/19/right-to-left-support-for-react-native-apps?utm_source=chatgpt.com 'Right-to-Left Layout Support For React Native Apps'
[7]: https://github.com/zoontek/react-native-localize?utm_source=chatgpt.com 'A toolbox for your React Native app localization'
